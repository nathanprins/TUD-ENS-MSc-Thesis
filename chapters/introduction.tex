\chapter{Introduction}
\label{chp:introduction}

\nocite{*}

Powered by the race of ever decreasing process-node sizes, more efficient battery chemistry, and an ever expanding wireless communication infrastructure, billions of Internet of Things (IoT) devices have entered our lives \cite{arif_2021, microsoft_2019}. However, the promis of "smart dust" seems to still elude us \cite{hester_2017}. In this vision, tiny internet connected devices permeate our clothing, infrastructure, and more, enabling us to monitor everything \cite{marr_2018}.

One of the key aspects of wireless devices holding us back from this idea is the reliance on rechargable, chemical batteries like those based on lithium. The lifespan of these batteries is severely limited by the number of charge cycles they can withstand before slowly reducing their total capacity. Moreover, even if they could maintain the same capacity throughout their entire lifespan, charging billions of sensor nodes is inconvenient if not impossible, especially if they are embedded in concrete structures for maintainance monitoring purposed for example.

The field of battery-free or batteryless computing aims to solve this by entirely ridding these devices of conventional batteries \cite{freebie, hester_2017, satya_2019}. Rather opting to use capacitors as energy reserves. Capacitors provide numerous pros compared to pouch or cylinder style lithium batteries, like tiny formfactor, no leakage current, solid state architecture and practically infinite lifetime, at least compared to other components within the device. 

Battery-free devices usually get their energy from harvesting. These sources could include solar (through photovoltaic cells) \cite{gameboy, colin_2018}, radio-frequency (through induction within the anntenae) \cite{gollakota_2014, wisp_2005}, kinetic (e.g. by pressing buttons that capture kinetic energy) \cite{gameboy} and sometimes a combination of two or more methods. As you might imagine, these sources are sparse and can be unpredictable. This makes wireless communication difficult. Uni-directional communication has been achieved by advertising data when enough power is available. Bi-directional communication has been achieved at short range using RFID where a reader interrogates a device which communicates back using the principle of backscatter \cite{wisp_2005}. Although this is bi-directional, it requires a reader to energize the sensor devices at a short distance. Medium range, high throughput communication with active radios has not been possible.

The system proposed by \cite{freebie}, called FreeBie, aims to solve this. It does so by using Bluetooth Low-energy and noting that, between transmission events, the System on Chip (SoC) could actually be powered down completely, only leaving on an ultra low-power real-time clock (RTC) tasked with turning the SoC back on just in time for the next transmittion. By doing so \cite{freebie} achieved the first ever battery-free devices capable of maintaining a wireless connection of a widely accepted standard. Even though BLE, as the name would suggest, has been developed for low-energy peripherals, its use within a intermittend devices has exposed some inefficiences previously considered accaptable.

The work within this thesis will be based on the FreeBie system and the work by de Winkel et al. By modifying the BLE stack sourcecode I aim to mitigate the inefficiencies mentioned in the previous paragraph. What these inefficiences are will be discusses in the next section.

\section*{Problem Statement}
\label{sec:introduction_problem_statement}

To provide context I would like to reiterate that intermittent devices receive their power through harvesting of ambiently available energy. Although I will not mention the variability and unreliability that comes with this as a specific problems to be solved, it is within this context that the issues that I aim to resolve do arise.

The first problem arises the instant a connection is formed. When the \textit{Central}, for example an Android phone, initiates a connection with a \textit{Peripheral}, or in this case FreeBie, it gets to decide the initial connection settings. These connection settings define the baseline connection speed and thus the power consumption of the perihperal. After the connection setup the peripheral can request more suitable connection parameters. However, this means that during the connection setup we have to contend with the default connection parameters of the central. In the case of a phone running the Android operating system (OS), these settings are high throughput and high power consumption. 

These unfavorable connection parameters force us to use capacitor sizes within FreeBie that, after the connection setup is finished, go mostly unused. This means the device as a whole increases in size and cost. 

The connection setup itself also has room for improvement. Using a naive approach, but often used approach, the connection setup is long and repetitive. For even a simple application the number of packets required to setup can easily exceed 70 packets. At Android's fast settings this takes a few seconds, but using slower settings which are more favorable for these ultra-low power devices it can take up to three minutes. With more complex applications these numbers increase rapidly.

Finally, considering the variability of the power harvesting methods that these devices employ, it is often advantageous to switch to a faster connection configuration when plenty of energy is available or even necessary to switch to a slower connection configuration to protect against a power failure. Using the procedures available within the BLE spec it takes a fixed six packets for the central to apply the connection settings after accepting them from the peripheral. This takes anywhere between tens of milliseconds up to nearly a minute, depending on the current connection parameters. 

Take as an example an intermittent device which takes its power from solar. If someone were to accidentally block the solar panel, then at the lowerst connection settings the device would not be able to throttle the connection fast enough to protect itself against a power failure.

From all this we can gather at least three possible improvements of BLE for the use within intermittent devices:
\begin{enumerate}
    \item Allow the Peripheral to dictate the initial connection parameters.
    \item Reduce the time required for the connection setup.
    \item Reduce the time required to apply new connectiodn parameters.
\end{enumerate}
Chapter \ref*{chp:chapter_2} covers the necessary background information. Chapter \ref*{chp:chapter_3} will explain the architecture of the proposed solutions. Chapter \ref*{chp:chapter_4} validates and evaluates the efficacy of these solutions.